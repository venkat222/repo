stage 'build'
node ('Linux'){
     git 'git@github.com:venkat222/repo.git'
     withEnv(["PATH+MAVEN=${tool 'maven3.3'}/bin"]) {
          sh "mvn -B clean package"
     }
     stash excludes: 'target/', includes: '**', name: 'source'
}
stage 'test'
parallel 'integration': {
     node ('Linux') {
          unstash 'source'
          withEnv(["PATH+MAVEN=${tool 'maven3.3'}/bin"]) {
               sh "mvn clean verify"
          }
     }
}, 'quality': {
     node ('Linux') {
          unstash 'source'
          withEnv(["PATH+MAVEN=${tool 'maven3.3'}/bin"]) {
               sh "mvn clean verify" //sonar:sonar
          }
     }
}
stage 'Results'
node ('Linux'){
     junit '**/target/surefire-reports/TEST-*.xml'
}


stage 'Artifacts'
node ('Linux'){
      archive 'target/*.war'
}
stage 'Finger Print'
node ('Linux'){
fingerprint 'target/**/*.war'
}

stage 'publisher'
node ('Linux'){
	 publishers {
        git {
            pushOnlyIfSuccess()
            tag('origin', 'foo-$PIPELINE_VERSION') {
                message('Release $PIPELINE_VERSION')
                create()
            }
        }
    }
}
